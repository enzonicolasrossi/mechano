<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Scientific Starsign Generator</title>
  <!-- Leaflet CSS for the map selector -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    form div {
      margin-bottom: 15px;
    }
    .glyph {
      width: 64px;
      height: 64px;
      margin: 5px;
    }
    #starsign {
      display: flex;
      flex-wrap: wrap;
      max-width: 400px;
      margin-top: 20px;
    }
    /* Progress Bar Styles */
    #progressBarContainer {
      width: 100%;
      background-color: #ddd;
      height: 20px;
    }
    #progressBar {
      width: 0;
      height: 100%;
      background-color: #4caf50;
    }
    /* Map container styling */
    #map {
      height: 300px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>Scientific Starsign Generator</h1>
  <p>Enter your scientific birth details to generate your unique starsign.</p>
  
  <!-- The Questions Form -->
  <form id="starsignForm">
    <div>
      <label for="birthDate">Enter your date of birth:</label><br>
      <input type="date" id="birthDate" name="birthDate" required>
    </div>
    <div>
      <label for="birthTime">Enter your time of birth:</label><br>
      <input type="time" id="birthTime" name="birthTime" required>
    </div>
    <div>
      <label>Select your location of birth:</label><br>
      <div id="map"></div>
      <!-- Hidden field to store the latitude and longitude -->
      <input type="hidden" id="birthLocation" name="birthLocation">
      <p>Click on the map to choose your birth location.</p>
    </div>
    <button type="submit">Generate Starsign</button>
  </form>
  
  <!-- Progress Bar (initially hidden) -->
  <div id="progressContainer" style="display:none; margin-top:20px;">
    <p>Processing your answers with science...</p>
    <div id="progressBarContainer">
      <div id="progressBar"></div>
    </div>
  </div>
  
  <!-- Container for the generated starsign -->
  <h2>Your Starsign</h2>
  <div id="starsign"></div>
  
  <!-- Leaflet JS for the map selector -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Build the glyphs array using the correct relative path.
    // Since Arnakotelonkaigue.html is in assets/, the images are located at:
    // assets/tiles/images/A (1).png  → relative path: "tiles/images/A (1).png"
    const glyphs = [];
    for (let i = 1; i <= 105; i++) {
      glyphs.push(`tiles/images/A (${i}).png`);
    }
    
    // Simple hash function that converts a string into a 32-bit integer.
    function hashString(str) {
      let hash = 0;
      for (let i = 0; i < str.length; i++) {
        hash = str.charCodeAt(i) + ((hash << 5) - hash);
        hash = hash & hash; // Convert to 32-bit integer
      }
      return hash;
    }
    
    // A seeded pseudo-random number generator (Mulberry32)
    function mulberry32(seed) {
      return function() {
        var t = seed += 0x6D2B79F5;
        t = Math.imul(t ^ (t >>> 15), t | 1);
        t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
      }
    }
    
    // Initialize the map for location selection using Leaflet.
    var map = L.map('map').setView([20, 0], 2); // Centered at latitude 20, longitude 0 with zoom level 2
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: '© OpenStreetMap'
    }).addTo(map);
    
    var marker;
    map.on('click', function(e) {
      var lat = e.latlng.lat.toFixed(5);
      var lng = e.latlng.lng.toFixed(5);
      // Remove the previous marker if it exists.
      if (marker) {
        map.removeLayer(marker);
      }
      marker = L.marker([lat, lng]).addTo(map);
      // Save the selected location in a hidden input as "lat,lng"
      document.getElementById('birthLocation').value = lat + ',' + lng;
    });
    
    // Listen for form submission.
    document.getElementById('starsignForm').addEventListener('submit', function(event) {
      event.preventDefault();  // Prevent the page from reloading
      
      // Ensure that a birth location has been selected.
      const birthLocation = document.getElementById('birthLocation').value;
      if (!birthLocation) {
        alert("Please select your birth location by clicking on the map.");
        return;
      }
      
      // Retrieve the input values.
      const birthDate = document.getElementById('birthDate').value;
      const birthTime = document.getElementById('birthTime').value;
      
      // Combine the answers to create a seed string.
      const seedString = birthDate + birthTime + birthLocation;
      
      // Generate a numeric seed from the combined answers.
      const seed = hashString(seedString);
      
      // Hide the form and display the progress bar.
      document.getElementById('starsignForm').style.display = 'none';
      document.getElementById('progressContainer').style.display = 'block';
      
      // Animate the progress bar.
      let progress = 0;
      const progressBar = document.getElementById('progressBar');
      const interval = setInterval(function() {
        progress += 1;
        progressBar.style.width = progress + '%';
        if (progress >= 100) {
          clearInterval(interval);
          // Once the progress reaches 100%, generate the starsign.
          generateStarsign(seed);
          // Hide the progress container after generation.
          document.getElementById('progressContainer').style.display = 'none';
        }
      }, 30); // Adjust the speed (30ms per 1% increment) as needed.
    });
    
    // Generate and display the starsign based on the seeded random generator.
    function generateStarsign(seed) {
      const random = mulberry32(seed);
      const numGlyphs = 5; // For example, display 5 glyphs.
      
      const starsignDiv = document.getElementById('starsign');
      starsignDiv.innerHTML = '';
      
      for (let i = 0; i < numGlyphs; i++) {
        const index = Math.floor(random() * glyphs.length);
        const img = document.createElement('img');
        img.src = glyphs[index];
        img.alt = 'Glyph ' + (index + 1);
        img.className = 'glyph';
        starsignDiv.appendChild(img);
      }
    }
  </script>
</body>
</html>
