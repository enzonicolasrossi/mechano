<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Open Muse v9.2.2</title>

<style>
:root {
  --radius: 12px;
  --radius-lg: 16px;

  --bg: #f3f4f6;
  --card-bg: #ffffff;
  --text: #1f2937;
  --text-light: #6b7280;
  --accent: #2563eb;

  --pill-bg: #e5e7eb;
  --pill-active: #2563eb;
  --pill-active-text: #ffffff;
}

.dark {
  --bg: #1a1b1f;
  --card-bg: #2a2b31;
  --text: #ececec;
  --text-light: #c1c1c1;
  --accent: #60a5fa;
  --pill-bg: #3b3d45;
  --pill-active: #60a5fa;
  --pill-active-text: #1a1b1f;
}

body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
  font-family: system-ui, sans-serif;
  display: flex;
  justify-content: center;
  padding: 40px 18px;
  transition: background 0.3s, color 0.3s;
}

.app-container {
  width: 100%;
  max-width: 780px;
  transition: opacity 0.3s;
}

/* ---------------- SUBTITLE LINK ---------------- */
.subtitle {
  opacity: 0.7;
}
.subtitle a {
  color: var(--accent);
  text-decoration: none;
  font-weight: 500;
}
.subtitle a:hover {
  text-decoration: underline;
}

/* Fullscreen overlay */
#fullscreenOverlay {
  position: fixed;
  inset: 0;
  background: #000;
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}
#fullscreenOverlay img {
  max-width: 95vw;
  max-height: 95vh;
  object-fit: contain;
  cursor: pointer;
}

/* Header */
.header {
  text-align: center;
  margin-bottom: 24px;
}
.header h1 {
  margin: 0;
  font-size: 2.3rem;
}

/* Settings */
.settings-toggle {
  text-align: right;
  margin-bottom: 10px;
}
.settings-toggle button {
  background: none;
  border: none;
  font-size: 22px;
  cursor: pointer;
  color: var(--text-light);
}
#settingsPanel {
  background: var(--card-bg);
  border-radius: var(--radius-lg);
  padding: 18px 22px;
  display: none;
  opacity: 0;
  box-shadow: 0 4px 16px rgba(0,0,0,0.07);
  margin-bottom: 14px;
  transition: opacity 0.3s;
}
.settings-row { margin-bottom: 14px; }
#fullscreenToggle {
  background: var(--accent);
  color: white;
  padding: 6px 14px;
  font-size: .9rem;
  border-radius: var(--radius);
  border: none;
  cursor: pointer;
}

/* Category header + panel */
#categoryHeader {
  background: var(--card-bg);
  padding: 14px 18px;
  border-radius: var(--radius);
  cursor: pointer;
  box-shadow: 0 3px 10px rgba(0,0,0,0.05);
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}
#categoryHeader span { font-weight: 600; }

#categoryPanel {
  display: none;
  opacity: 0;
  padding: 14px 10px;
  border-radius: var(--radius-lg);
  background: var(--card-bg);
  box-shadow: 0 4px 14px rgba(0,0,0,0.08);
  transition: opacity 0.25s;
  margin-bottom: 14px;
}

/* Pills */
.pills {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}
.pill {
  padding: 10px 16px;
  background: var(--pill-bg);
  border-radius: 999px;
  cursor: pointer;
  font-size: .95rem;
  flex-shrink: 0;
}
.pill.active {
  background: var(--pill-active);
  color: var(--pill-active-text);
  font-weight: 600;
}

/* Buttons */
button.generate {
  width: 100%;
  padding: 14px;
  font-size: 1rem;
  background: var(--accent);
  color: white;
  border: none;
  border-radius: var(--radius);
  cursor: pointer;
  margin-bottom: 12px;
}

/* Image & filename */
#image {
  margin-top: 20px;
  min-height: 360px;
  position: relative;
}
#image img {
  width: 100%;
  max-height: 65vh;
  object-fit: contain;
  cursor: pointer;
}
#welcome {
  background: var(--card-bg);
  padding: 22px;
  border-radius: var(--radius-lg);
  box-shadow: 0 4px 16px rgba(0,0,0,0.06);
  position: absolute;
  width: 100%;
  text-align: center;
}
#filename {
  margin-top: 14px;
  text-align: center;
  font-size: .95rem;
  opacity: .75;
}

/* Loading animation */
.loading-container {
  position: relative;
  width: 100%;
  height: 330px;
}
.skeleton {
  width: 100%;
  height: 100%;
  border-radius: var(--radius-lg);
  background: linear-gradient(90deg,#ddd,#eee,#ddd);
  animation: shine 1.3s infinite linear;
}
.dark .skeleton {
  background: linear-gradient(90deg,#444,#555,#444);
}
.spinner {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 40px;
  height: 40px;
  margin: -20px 0 0 -20px;
  border-radius: 50%;
  border: 4px solid rgba(0,0,0,0.15);
  border-top-color: var(--accent);
  animation: spin 0.8s linear infinite;
}
.loading-label {
  position: absolute;
  top: calc(50% + 28px);
  left: 50%;
  transform: translateX(-50%);
  font-size: 0.9rem;
  opacity: 0.8;
}

/* Animations */
@keyframes shine {
  0% { background-position: 200%; }
  100% { background-position: -200%; }
}
@keyframes spin {
  to { transform: rotate(360deg); }
}
</style>
</head>



<body>
<div class="app-container" id="app">

  <div class="header">
    <h1>Open Muse</h1>

    <div class="subtitle" id="subtitleText">
      v9.2.2 ‚Äî by
      <a href="https://instagram.com/rossipintos" target="_blank" rel="noopener noreferrer">
        @rossipintos
      </a>
    </div>
  </div>

  <div class="settings-toggle">
    <button id="settingsBtn">‚öôÔ∏è</button>
  </div>

  <div id="settingsPanel">
    <div class="settings-row">
      <strong id="darkModeLabel">Dark Mode</strong><br>
      <label><input type="checkbox" id="darkToggle"> <span id="darkModeEnableLabel">Enable</span></label>
    </div>
    <div class="settings-row">
      <strong id="autoAdvanceLabel">Auto-advance</strong><br>
      <label><input type="radio" name="timer" value="0" checked> <span id="timerOffLabel">Off</span></label>
      <label><input type="radio" name="timer" value="15"> 15s</label>
      <label><input type="radio" name="timer" value="30"> 30s</label>
      <label><input type="radio" name="timer" value="60"> 60s</label>
      <label><input type="radio" name="timer" value="120"> 120s</label>
    </div>
    <div class="settings-row">
      <strong id="fullscreenLabel">Fullscreen</strong><br>
      <button id="fullscreenToggle">Enter Fullscreen</button>
    </div>
    <div class="settings-row">
      <strong id="languageLabel">Language (UI)</strong><br>
      <label><input type="radio" name="lang" value="en"> English</label>
      <label><input type="radio" name="lang" value="es"> Espa√±ol</label>
      <label><input type="radio" name="lang" value="no"> Norsk</label>
    </div>
  </div>

  <div id="categoryHeader">
    <span id="categoryLabel">Category: Mechanical</span> ‚ñº
  </div>

  <div id="categoryPanel">
    <div class="pills" id="pillContainer"></div>
  </div>

  <button class="generate" id="generate">Generate</button>

  <div id="image">
    <div id="welcome">
      <h2 id="welcomeTitle">Welcome to Open Muse</h2>
      <p id="welcomeLine1">Random reference images from the public domain.</p>
      <p id="welcomeLine2">Select a category or press Generate.</p>
      <p id="welcomeLine3">Press Space anytime.</p>
    </div>
  </div>

  <div id="filename"></div>
</div>

<div id="fullscreenOverlay"></div>



<script>
/* ---------------- UI LANGUAGE STRINGS ---------------- */

const UI_STRINGS = {
  en: {
    subtitle: "v9.2.2 ‚Äî by @rossipintos",
    darkMode: "Dark Mode",
    darkModeEnable: "Enable",
    autoAdvance: "Auto-advance",
    fullscreen: "Fullscreen",
    language: "Language (UI)",
    timerOff: "Off",
    fullscreenBtn: "Enter Fullscreen",
    generate: "Generate",
    welcomeTitle: "Welcome to Open Muse",
    welcomeLine1: "Random reference images from the public domain.",
    welcomeLine2: "Select a category or press Generate.",
    welcomeLine3: "Press Space anytime.",
    categoryPrefix: "Category: ",
    nothingFound: "Nothing found.",
    loadingText: "Loading..."
  },
  es: {
    subtitle: "v9.2.2 ‚Äî por @rossipintos",
    darkMode: "Modo oscuro",
    darkModeEnable: "Activar",
    autoAdvance: "Cambio autom√°tico",
    fullscreen: "Pantalla completa",
    language: "Idioma (interfaz)",
    timerOff: "Apagado",
    fullscreenBtn: "Entrar en pantalla completa",
    generate: "Generar",
    welcomeTitle: "Bienvenido a Open Muse",
    welcomeLine1: "Im√°genes de referencia aleatorias de dominio p√∫blico.",
    welcomeLine2: "Eleg√≠ una categor√≠a o apret√° Generar.",
    welcomeLine3: "Pod√©s usar la barra espaciadora en cualquier momento.",
    categoryPrefix: "Categor√≠a: ",
    nothingFound: "No se encontr√≥ nada.",
    loadingText: "Cargando..."
  },
  no: {
    subtitle: "v9.2.2 ‚Äî av @rossipintos",
    darkMode: "M√∏rk modus",
    darkModeEnable: "Aktiver",
    autoAdvance: "Auto-bytte",
    fullscreen: "Fullskjerm",
    language: "Spr√•k (UI)",
    timerOff: "Av",
    fullscreenBtn: "G√• til fullskjerm",
    generate: "Generer",
    welcomeTitle: "Velkommen til Open Muse",
    welcomeLine1: "Tilfeldige referansebilder fra det offentlige domene.",
    welcomeLine2: "Velg en kategori eller trykk Generer.",
    welcomeLine3: "Du kan bruke mellomromstasten n√•r som helst.",
    categoryPrefix: "Kategori: ",
    nothingFound: "Ingenting funnet.",
    loadingText: "Laster..."
  }
};

let currentLang = localStorage.getItem("uiLang") || "en";

function applyLanguage() {
  const t = UI_STRINGS[currentLang];

  document.getElementById("subtitleText").innerHTML =
    `v9.2.2 ‚Äî by <a href="https://instagram.com/rossipintos" target="_blank" rel="noopener noreferrer">@rossipintos</a>`;

  document.getElementById("darkModeLabel").textContent = t.darkMode;
  document.getElementById("darkModeEnableLabel").textContent = t.darkModeEnable;
  document.getElementById("autoAdvanceLabel").textContent = t.autoAdvance;
  document.getElementById("fullscreenLabel").textContent = t.fullscreen;
  document.getElementById("languageLabel").textContent = t.language;
  document.getElementById("fullscreenToggle").textContent = t.fullscreenBtn;
  document.getElementById("generate").textContent = t.generate;
  document.getElementById("timerOffLabel").textContent = t.timerOff;

  const welcomeTitle = document.getElementById("welcomeTitle");
  if (welcomeTitle) {
    welcomeTitle.textContent = t.welcomeTitle;
    document.getElementById("welcomeLine1").textContent = t.welcomeLine1;
    document.getElementById("welcomeLine2").textContent = t.welcomeLine2;
    document.getElementById("welcomeLine3").textContent = t.welcomeLine3;
  }

  const labelEl = document.getElementById("categoryLabel");
  const parts = labelEl.textContent.split(": ");
  const suffix = parts.length > 1 ? parts.slice(1).join(": ") : labelEl.textContent;
  labelEl.textContent = t.categoryPrefix + suffix;
}

/* ---------------- CATEGORIES ---------------- */

const CATEGORIES = {
  all:          "‚≠ê All Categories",
  mechanical:   "‚öô Mechanical",
  blueprints:   "üìò Blueprints & Schematics",
  tools:        "üõ† Tools & Implements",
  robots:       "ü§ñ Robots & Mechanical Arms",
  aquatic:      "üåä Aquatic & Marine",

  bio:          "üß¨ Biological",
  anatomy:      "ü´Ä Anatomy",
  entomology:   "ü™≤ Insects",
  botanical:    "üåø Botanical Illustration",

  fossils:      "ü¶¥ Fossils & Paleontology",
  ancient:      "ü™® Ancient Artifacts",
  masks:        "üé≠ Ritual Masks & Art",

  esoteric:     "üîÆ Esoteric Symbols",
  writing:      "üî§ Writing Systems",
  patterns:     "üßµ Patterns & Ornament",

  architecture: "üìê Architecture",
  space:        "üöÄ Space",
  science_diagrams: "üß™ Science Diagrams"
};

const CATEGORY_MAP = {
  mechanical: [
    "Category:Machine_elements",
    "Category:Bearings",
    "Category:Gears",
    "Category:Engines",
    "Category:Mechanical_drawings"
  ],
  blueprints: [
    "Category:Blueprints",
    "Category:Technical_drawings",
    "Category:Patent_drawings"
  ],
  tools: [
    "Category:Hand_tools",
    "Category:Construction_tools",
    "Category:Surgical_tools"
  ],
  robots: [
    "Category:Industrial_robots",
    "Category:Humanoid_robots",
    "Category:Robot_arms"
  ],
  aquatic: [
    "Category:Marine_life",
    "Category:Fish_illustrations",
    "Category:Marine_mammals",
    "Category:Coral_reefs",
    "Category:Underwater_photographs"
  ],
  bio: [
    "Category:Biological_illustrations",
    "Category:Biological_diagrams"
  ],
  anatomy: [
    "Category:Anatomical_illustrations",
    "Category:Anatomical_illustrations_of_muscles"
  ],
  entomology: [
    "Category:Illustrations_of_insects",
    "Category:Drawings_of_insects",
    "Category:Insects_in_book_illustrations"
  ],
  botanical: [
    "Category:Botanical_illustrations",
    "Category:Herbarium_specimens"
  ],
  fossils: [
    "Category:Fossils",
    "Category:Fossils_in_museums",
    "Category:Fossils_by_type"
  ],
  ancient: [
    "Category:Cave_paintings",
    "Category:Rock_art",
    "Category:Petroglyphs",
    "Category:Ancient_tools"
  ],
  masks: [
    "Category:African_masks",
    "Category:Ritual_masks",
    "Category:Indigenous_masks"
  ],
  esoteric: [
    "Category:Alchemy_symbols",
    "Category:Magical_symbols",
    "Category:Astrological_symbols"
  ],
  writing: [
    "Category:Runes",
    "Category:Ogham",
    "Category:Neographies",
    "Category:Cuneiform",
    "Category:Chinese_calligraphy",
    "Category:Japanese_calligraphy"
  ],
  patterns: [
    "Category:Islamic_geometric_patterns",
    "Category:Textile_patterns",
    "Category:Ceramic_patterns"
  ],
  architecture: [
    "Category:Architectural_drawings",
    "Category:Stained_glass",
    "Category:Gothic_architecture_drawings"
  ],
  space: [
    "Category:Astronomical_diagrams",
    "Category:Spacecraft_diagrams",
    "Category:Nasa_drawings"
  ],
  science_diagrams: [
    "Category:Mathematical_diagrams",
    "Category:Physics_diagrams",
    "Category:Chemical_diagrams"
  ]
};

CATEGORY_MAP.all = Object.values(CATEGORY_MAP).flat();

/* ---------------- BUILD PILLS ---------------- */

const pillContainer = document.getElementById("pillContainer");
Object.entries(CATEGORIES).forEach(([key, label]) => {
  const pill = document.createElement("div");
  pill.className = "pill";
  pill.dataset.category = key;
  pill.textContent = label;
  pill.onclick = () => {
    currentCategory = key;
    highlightPill(key);
    const prefix = UI_STRINGS[currentLang].categoryPrefix;
    document.getElementById("categoryLabel").textContent = prefix + label;
    toggleCategoryPanel(false);
  };
  pillContainer.appendChild(pill);
});

function highlightPill(cat) {
  document.querySelectorAll(".pill").forEach(p =>
    p.classList.toggle("active", p.dataset.category === cat)
  );
}

let currentCategory = "mechanical";
highlightPill(currentCategory);

/* ---------------- CATEGORY PANEL TOGGLE ---------------- */

const categoryHeader = document.getElementById("categoryHeader");
const categoryPanel  = document.getElementById("categoryPanel");

categoryHeader.onclick = () => toggleCategoryPanel();

function toggleCategoryPanel(forceState) {
  const show = (forceState !== undefined)
    ? forceState
    : categoryPanel.style.display !== "block";

  if (show) {
    categoryPanel.style.display = "block";
    setTimeout(() => categoryPanel.style.opacity = 1, 10);
  } else {
    categoryPanel.style.opacity = 0;
    setTimeout(() => categoryPanel.style.display = "none", 200);
  }
}

/* ---------------- SETTINGS PANEL ---------------- */

const settingsBtn   = document.getElementById("settingsBtn");
const settingsPanel = document.getElementById("settingsPanel");

settingsBtn.onclick = () => {
  if (settingsPanel.style.display === "block") {
    settingsPanel.style.opacity = 0;
    setTimeout(() => settingsPanel.style.display = "none", 200);
  } else {
    settingsPanel.style.display = "block";
    setTimeout(() => settingsPanel.style.opacity = 1, 10);
  }
};

/* ---------------- DARK MODE ---------------- */

const darkToggle = document.getElementById("darkToggle");

if (localStorage.getItem("darkMode") === "true") {
  document.body.classList.add("dark");
  darkToggle.checked = true;
}

darkToggle.onchange = () => {
  document.body.classList.toggle("dark");
  localStorage.setItem("darkMode", document.body.classList.contains("dark"));
};

/* ---------------- LANGUAGE RADIO INIT ---------------- */

document.querySelectorAll('input[name="lang"]').forEach(r => {
  r.checked = (r.value === currentLang);
  r.onchange = () => {
    currentLang = r.value;
    localStorage.setItem("uiLang", currentLang);
    applyLanguage();
  };
});

applyLanguage();

/* ---------------- FETCH FROM WIKIMEDIA ---------------- */

async function fetchCategory(cat) {
  const url =
    `https://commons.wikimedia.org/w/api.php?action=query&generator=categorymembers&gcmtitle=${encodeURIComponent(cat)}&gcmtype=file&gcmlimit=500&prop=imageinfo&iiprop=url&format=json&origin=*`;

  const res = await fetch(url);
  const data = await res.json();
  if (!data.query) return [];

  const allowed = /\.(jpg|jpeg|png|gif|svg)$/i;

  return Object.values(data.query.pages)
    .filter(p => p.imageinfo && allowed.test(p.imageinfo[0].url))
    .map(p => ({
      title: p.title.replace("File:", ""),
      url: p.imageinfo[0].url
    }));
}

let cache = {};

async function loadImages(cat) {
  if (!cache[cat]) {
    cache[cat] = [];
    for (const c of CATEGORY_MAP[cat]) {
      cache[cat].push(...await fetchCategory(c));
    }
  }
  return cache[cat];
}

/* ---------------- TIMER ---------------- */

let timer = null;

function resetTimer() {
  if (timer) clearInterval(timer);
  const val = parseInt(document.querySelector('input[name="timer"]:checked').value);
  if (val > 0) {
    timer = setInterval(generate, val * 1000);
  }
}

document.querySelectorAll('input[name="timer"]').forEach(r => {
  r.onchange = resetTimer;
});

/* ---------------- FULLSCREEN ---------------- */

const fullscreenToggle = document.getElementById("fullscreenToggle");
const fullscreenOverlay = document.getElementById("fullscreenOverlay");
const app = document.getElementById("app");

fullscreenToggle.onclick = () => {
  fullscreenOverlay.style.display = "flex";
  app.style.opacity = 0;
  settingsPanel.style.opacity = 0;
  setTimeout(() => settingsPanel.style.display = "none", 200);
};

fullscreenOverlay.onclick = () => {
  fullscreenOverlay.style.display = "none";
  app.style.opacity = 1;
};

document.addEventListener("keydown", e => {
  if (e.key === "Escape" && fullscreenOverlay.style.display === "flex") {
    fullscreenOverlay.style.display = "none";
    app.style.opacity = 1;
  }
});

/* ---------------- GENERATE ---------------- */

const imgDiv   = document.getElementById("image");
const filename = document.getElementById("filename");

function showLoading(targetEl) {
  const t = UI_STRINGS[currentLang];
  targetEl.innerHTML = `
    <div class="loading-container">
      <div class="skeleton"></div>
      <div class="spinner"></div>
      <div class="loading-label">${t.loadingText}</div>
    </div>
  `;
}

async function generate() {
  if (fullscreenOverlay.style.display === "flex") {
    showLoading(fullscreenOverlay);
  } else {
    showLoading(imgDiv);
  }
  filename.textContent = "";

  const files = await loadImages(currentCategory);
  if (!files.length) {
    filename.textContent = UI_STRINGS[currentLang].nothingFound;
    return;
  }

  const welcome = document.getElementById("welcome");
  if (welcome) welcome.remove();

  const f = files[Math.floor(Math.random() * files.length)];

  if (fullscreenOverlay.style.display === "flex") {
    fullscreenOverlay.innerHTML = `<img src="${f.url}">`;
  } else {
    imgDiv.innerHTML = `<img src="${f.url}">`;
  }

  filename.innerHTML =
    `<a href="https://commons.wikimedia.org/wiki/File:${encodeURIComponent(f.title)}" target="_blank">${f.title}</a>`;

  resetTimer();
}

document.getElementById("generate").onclick = generate;

document.addEventListener("keydown", e => {
  if (e.code === "Space") {
    e.preventDefault();
    generate();
  }
});
</script>

</body>
</html>
